@page
@model IndexModel
@using LLiveArenaWeb.Models
@{
    ViewData["Title"] = "Home";
}

@functions {
    private string GetMatchDisplayName(MatchListItem match)
    {
        if (match.Section == null || match.Section.Count < 2) return match.Ename;
        
        var homeTeam = match.Section.FirstOrDefault(s => s.Sno == 1);
        var awayTeam = match.Section.FirstOrDefault(s => s.Sno == 3);
        
        if (homeTeam != null && awayTeam != null)
        {
            return $"{homeTeam.Nat} vs {awayTeam.Nat}";
        }
        
        return match.Ename;
    }
    
    private string GetMatchStatus(MatchListItem match)
    {
        if (match.Iplay)
            return "Live";
        if (match.Status == "SUSPENDED")
            return "Suspended";
        if (match.Status == "OPEN")
            return "Upcoming";
        return match.Status;
    }

    private string NormalizeCompetitionName(string? competitionName)
    {
        if (string.IsNullOrWhiteSpace(competitionName))
        {
            return "Top League";
        }

        var name = competitionName.ToUpperInvariant();
        if (name.Contains("CHAMPIONS LEAGUE"))
        {
            return "Champions League";
        }
        if (name.Contains("EUROPA") || name.Contains("EUROPE"))
        {
            return "Europa League";
        }
        if (name.Contains("CONFERENCE"))
        {
            return "Conference League";
        }
        if (name.Contains("WORLD CUP"))
        {
            return "World Cup";
        }
        if (name.Contains("EURO"))
        {
            return "Euro Cup";
        }
        if (name.Contains("COPA AMERICA"))
        {
            return "Copa America";
        }

        return competitionName;
    }
    
    private string GetStatusClass(MatchListItem match)
    {
        if (match.Iplay)
            return "status-live";
        if (match.Status == "SUSPENDED")
            return "";
        return "status-hot";
    }
    
    private DateTime? ParseStartTime(string stime)
    {
        if (DateTime.TryParse(stime, out var result))
        {
            return result;
        }
        return null;
    }
}

<section class="hero">
    <span class="tag">Live now</span>
    <h1>Live Sports Center</h1>
    <p>Watch, follow and track live sports events</p>
</section>

<section class="section">
    <div class="section-header">
        <h2>@(Model.SelectedLeagueDisplay ?? "Top Leagues")</h2>
        <span class="section-pill">Prematch & Live</span>
    </div>
    <div class="top-leagues-layout">
        <div class="top-leagues-list">
            @if (Model.LeagueMatches.Any())
            {
                @foreach (var match in Model.LeagueMatches)
                {
                    var startTime = ParseStartTime(match.Stime);
                    var targetPage = match.Iplay ? "/Live" : "/Match";
                    <a asp-page="@targetPage" asp-route-gmid="@match.Gmid" class="league-card">
                        <div class="league-card-meta">
                            <span class="league-card-label">@NormalizeCompetitionName(match.Cname)</span>
                            <h3>@GetMatchDisplayName(match)</h3>
                            <p>
                                @if (startTime.HasValue)
                                {
                                    <text>@startTime.Value.ToString("dd MMM · HH:mm")</text>
                                }
                                else if (!string.IsNullOrEmpty(match.Stime))
                                {
                                    <text>@match.Stime</text>
                                }
                                else
                                {
                                    <text>Upcoming</text>
                                }
                            </p>
                        </div>
                        <div class="league-card-status">
                            <span class="status-pill @GetStatusClass(match)">@GetMatchStatus(match)</span>
                            <span class="league-card-time">@(match.Iplay ? "Live" : "Prematch")</span>
                        </div>
                    </a>
                }
            }
            else if (Model.PrematchMatches.Any())
            {
                @foreach (var match in Model.PrematchMatches.Take(2))
                {
                    var startTime = ParseStartTime(match.Stime);
                    var targetPage = match.Iplay ? "/Live" : "/Match";
                    <a asp-page="@targetPage" asp-route-gmid="@match.Gmid" class="league-card">
                        <div class="league-card-meta">
                            <span class="league-card-label">@NormalizeCompetitionName(match.Cname)</span>
                            <h3>@GetMatchDisplayName(match)</h3>
                            <p>
                                @if (startTime.HasValue)
                                {
                                    <text>@startTime.Value.ToString("dd MMM · HH:mm")</text>
                                }
                                else if (!string.IsNullOrEmpty(match.Stime))
                                {
                                    <text>@match.Stime</text>
                                }
                                else
                                {
                                    <text>Upcoming</text>
                                }
                            </p>
                        </div>
                        <div class="league-card-status">
                            <span class="status-pill @GetStatusClass(match)">@GetMatchStatus(match)</span>
                            <span class="league-card-time">Prematch</span>
                        </div>
                    </a>
                }
            }
            else
            {
                <div class="league-card">
                    <div class="league-card-meta">
                        <span class="league-card-label">Top League</span>
                        <h3>Loading league games...</h3>
                        <p>Upcoming match details will appear here.</p>
                    </div>
                </div>
                <div class="league-card">
                    <div class="league-card-meta">
                        <span class="league-card-label">Top League</span>
                        <h3>Loading league games...</h3>
                        <p>Upcoming match details will appear here.</p>
                    </div>
                </div>
            }
        </div>

        <aside class="league-side">
            <h3>Leagues</h3>
            <div class="league-list">
                <a class="league-item @(Model.SelectedLeagueKey == "champions-league" ? "active" : "")" asp-page="/Index" asp-route-league="champions-league">
                    <span class="league-logo"><img src="~/images/leagues/champions-league.webp" alt="Champions League" /></span>
                    <span>Champions League</span>
                </a>
                <a class="league-item @(Model.SelectedLeagueKey == "europa-league" ? "active" : "")" asp-page="/Index" asp-route-league="europa-league">
                    <span class="league-logo"><img src="~/images/leagues/europa-league.webp" alt="Europa League" /></span>
                    <span>Europa League</span>
                </a>
                <a class="league-item @(Model.SelectedLeagueKey == "conference-league" ? "active" : "")" asp-page="/Index" asp-route-league="conference-league">
                    <span class="league-logo"><img src="~/images/leagues/conference-league.webp" alt="Conference League" /></span>
                    <span>Conference League</span>
                </a>
                <a class="league-item @(Model.SelectedLeagueKey == "world-cup" ? "active" : "")" asp-page="/Index" asp-route-league="world-cup">
                    <span class="league-logo"><img src="~/images/leagues/world-cup.webp" alt="World Cup" /></span>
                    <span>World Cup</span>
                </a>
                <a class="league-item @(Model.SelectedLeagueKey == "euro" ? "active" : "")" asp-page="/Index" asp-route-league="euro">
                    <span class="league-logo"><img src="~/images/leagues/euro-cup.webp" alt="Euro Cup" /></span>
                    <span>Euro Cup</span>
                </a>
                <a class="league-item @(Model.SelectedLeagueKey == "copa-america" ? "active" : "")" asp-page="/Index" asp-route-league="copa-america">
                    <span class="league-logo"><img src="~/images/leagues/copa-america.webp" alt="Copa America" /></span>
                    <span>Copa America</span>
                </a>
            </div>
        </aside>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h2>Latest News</h2>
        <span class="section-pill">Preview</span>
    </div>
    <div class="news-grid">
        <article class="news-card">
            <span class="news-tag">Breaking</span>
            <h3>Championship schedule announced</h3>
            <p>Full fixture list drops with prime-time matchups.</p>
        </article>
        <article class="news-card">
            <span class="news-tag">Analysis</span>
            <h3>Power rankings shake up the standings</h3>
            <p>Top teams surge after a decisive weekend.</p>
        </article>
        <article class="news-card">
            <span class="news-tag">Spotlight</span>
            <h3>Rookie star breaks debut record</h3>
            <p>Early season form hints at a breakout campaign.</p>
        </article>
    </div>
</section>

<section class="home-footer">
    <div>
        <h2>Never miss a moment</h2>
        <p>Stay locked in with live scores, instant alerts, and curated highlights.</p>
    </div>
    <a class="home-footer-button" asp-area="" asp-page="/Live">Explore Live</a>
</section>
