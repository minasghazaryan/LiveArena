@page
@model IndexModel
@using LLiveArenaWeb.Models
@{
    ViewData["Title"] = "Home";
}

@functions {
    private string GetMatchDisplayName(MatchListItem match)
    {
        if (match.Section == null || match.Section.Count < 2) return match.Ename;
        
        var homeTeam = match.Section.FirstOrDefault(s => s.Sno == 1);
        var awayTeam = match.Section.FirstOrDefault(s => s.Sno == 3);
        
        if (homeTeam != null && awayTeam != null)
        {
            return $"{homeTeam.Nat} vs {awayTeam.Nat}";
        }
        
        return match.Ename;
    }
    
    private string GetMatchStatus(MatchListItem match)
    {
        if (match.Iplay)
            return "Live";
        if (match.Status == "SUSPENDED")
            return "Suspended";
        if (match.Status == "OPEN")
            return "Upcoming";
        return match.Status;
    }
    
    private string GetStatusClass(MatchListItem match)
    {
        if (match.Iplay)
            return "status-live";
        if (match.Status == "SUSPENDED")
            return "";
        return "status-hot";
    }
    
    private DateTime? ParseStartTime(string stime)
    {
        if (DateTime.TryParse(stime, out var result))
        {
            return result;
        }
        return null;
    }
}

<section class="hero">
    <span class="tag">Live now</span>
    <h1>Live Sports Center</h1>
    <p>Watch, follow and track live sports events</p>
</section>

<section class="section">
    <div class="section-header">
        <h2>Top Matches</h2>
        <span class="section-pill">Prematch</span>
    </div>
    <div class="match-grid">
        @if (Model.PrematchMatches.Any())
        {
            @foreach (var match in Model.PrematchMatches.Take(3))
            {
                var startTime = ParseStartTime(match.Stime);
                <a asp-page="/Live" asp-route-gmid="@match.Gmid" class="match-card" style="text-decoration: none; color: inherit; cursor: pointer;">
                    <div>
                        <h3>@GetMatchDisplayName(match)</h3>
                        <p>
                            @if (!string.IsNullOrEmpty(match.Cname))
                            {
                                <text>@match.Cname</text>
                            }
                            @if (startTime.HasValue)
                            {
                                <text> · @startTime.Value.ToString("HH:mm")</text>
                            }
                            else if (!string.IsNullOrEmpty(match.Stime))
                            {
                                <text> · @match.Stime</text>
                            }
                        </p>
                        <p style="font-weight: bold; margin-top: 0.5rem; color: #00ff88;">Upcoming</p>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem;">
                        <span class="status-pill @GetStatusClass(match)">@GetMatchStatus(match)</span>
                        @if (match.Tv)
                        {
                            <span class="status-pill" style="font-size: 0.7rem;">TV</span>
                        }
                        @if (match.Bm)
                        {
                            <span class="status-pill status-live" style="font-size: 0.7rem;">BM</span>
                        }
                    </div>
                </a>
            }
        }
        else
        {
            <article class="match-card">
                <div>
                    <h3>Loading top matches...</h3>
                    <p>Fetching latest match data from API</p>
                </div>
            </article>
            <article class="match-card">
                <div>
                    <h3>Loading top matches...</h3>
                    <p>Fetching latest match data from API</p>
                </div>
            </article>
            <article class="match-card">
                <div>
                    <h3>Loading top matches...</h3>
                    <p>Fetching latest match data from API</p>
                </div>
            </article>
        }
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h2>Latest News</h2>
        <span class="section-pill">Preview</span>
    </div>
    <div class="news-grid">
        <article class="news-card">
            <span class="news-tag">Breaking</span>
            <h3>Championship schedule announced</h3>
            <p>Full fixture list drops with prime-time matchups.</p>
        </article>
        <article class="news-card">
            <span class="news-tag">Analysis</span>
            <h3>Power rankings shake up the standings</h3>
            <p>Top teams surge after a decisive weekend.</p>
        </article>
        <article class="news-card">
            <span class="news-tag">Spotlight</span>
            <h3>Rookie star breaks debut record</h3>
            <p>Early season form hints at a breakout campaign.</p>
        </article>
    </div>
</section>

<section class="home-footer">
    <div>
        <h2>Never miss a moment</h2>
        <p>Stay locked in with live scores, instant alerts, and curated highlights.</p>
    </div>
    <a class="home-footer-button" asp-area="" asp-page="/Live">Explore Live</a>
</section>
